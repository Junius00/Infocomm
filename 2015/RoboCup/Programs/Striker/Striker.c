#include "HardwareInfo.c"
#include <GetCompoI3.h>
#include <GetADScable10.h>
#include <SetLCDBack.h>
#include <SetLCD3Char.h>
#include <GetCompoI3.h>
#include <SetMotor.h>
#include <GetCompassB.h>
signed int vd[361][2]={{100,100},{100,97},{100,93},{100,90},{100,87},{100,84},{100,81},{100,78},{100,75},{100,73},{100,70},{100,67},{100,65},{100,62},{100,60},{100,58},{100,55},{100,53},{100,51},{100,49},{100,47},{100,45},{100,42},{100,40},{100,38},{100,36},{100,34},{100,32},{100,31},{100,29},{100,27},{100,25},{100,23},{100,21},{100,19},{100,18},{100,16},{100,14},{100,12},{100,11},{100,9},{100,7},{100,5},{100,3},{100,2},{100,0},{100,-2},{100,-3},{100,-5},{100,-7},{100,-9},{100,-11},{100,-12},{100,-14},{100,-16},{100,-18},{100,-19},{100,-21},{100,-23},{100,-25},{100,-27},{100,-29},{100,-31},{100,-32},{100,-34},{100,-36},{100,-38},{100,-40},{100,-42},{100,-45},{100,-47},{100,-49},{100,-51},{100,-53},{100,-55},{100,-58},{100,-60},{100,-62},{100,-65},{100,-67},{100,-70},{100,-73},{100,-75},{100,-78},{100,-81},{100,-84},{100,-87},{100,-90},{100,-93},{100,-97},{100,-100},{97,-100},{93,-100},{90,-100},{87,-100},{84,-100},{81,-100},{78,-100},{75,-100},{73,-100},{70,-100},{67,-100},{65,-100},{62,-100},{60,-100},{58,-100},{55,-100},{53,-100},{51,-100},{49,-100},{47,-100},{45,-100},{42,-100},{40,-100},{38,-100},{36,-100},{34,-100},{32,-100},{31,-100},{29,-100},{27,-100},{25,-100},{23,-100},{21,-100},{19,-100},{18,-100},{16,-100},{14,-100},{12,-100},{11,-100},{9,-100},{7,-100},{5,-100},{3,-100},{2,-100},{0,-100},{-2,-100},{-3,-100},{-5,-100},{-7,-100},{-9,-100},{-11,-100},{-12,-100},{-14,-100},{-16,-100},{-18,-100},{-19,-100},{-21,-100},{-23,-100},{-25,-100},{-27,-100},{-29,-100},{-31,-100},{-32,-100},{-34,-100},{-36,-100},{-38,-100},{-40,-100},{-42,-100},{-45,-100},{-47,-100},{-49,-100},{-51,-100},{-53,-100},{-55,-100},{-58,-100},{-60,-100},{-62,-100},{-65,-100},{-67,-100},{-70,-100},{-73,-100},{-75,-100},{-78,-100},{-81,-100},{-84,-100},{-87,-100},{-90,-100},{-93,-100},{-97,-100},{-100,-100},{-100,-97},{-100,-93},{-100,-90},{-100,-87},{-100,-84},{-100,-81},{-100,-78},{-100,-75},{-100,-73},{-100,-70},{-100,-67},{-100,-65},{-100,-62},{-100,-60},{-100,-58},{-100,-55},{-100,-53},{-100,-51},{-100,-49},{-100,-47},{-100,-45},{-100,-42},{-100,-40},{-100,-38},{-100,-36},{-100,-34},{-100,-32},{-100,-31},{-100,-29},{-100,-27},{-100,-25},{-100,-23},{-100,-21},{-100,-19},{-100,-18},{-100,-16},{-100,-14},{-100,-12},{-100,-11},{-100,-9},{-100,-7},{-100,-5},{-100,-3},{-100,-2},{-100,0},{-100,2},{-100,3},{-100,5},{-100,7},{-100,9},{-100,11},{-100,12},{-100,14},{-100,16},{-100,18},{-100,19},{-100,21},{-100,23},{-100,25},{-100,27},{-100,29},{-100,31},{-100,32},{-100,34},{-100,36},{-100,38},{-100,40},{-100,42},{-100,45},{-100,47},{-100,49},{-100,51},{-100,53},{-100,55},{-100,58},{-100,60},{-100,62},{-100,65},{-100,67},{-100,70},{-100,73},{-100,75},{-100,78},{-100,81},{-100,84},{-100,87},{-100,90},{-100,93},{-100,97},{-100,100},{-97,100},{-93,100},{-90,100},{-87,100},{-84,100},{-81,100},{-78,100},{-75,100},{-73,100},{-70,100},{-67,100},{-65,100},{-62,100},{-60,100},{-58,100},{-55,100},{-53,100},{-51,100},{-49,100},{-47,100},{-45,100},{-42,100},{-40,100},{-38,100},{-36,100},{-34,100},{-32,100},{-31,100},{-29,100},{-27,100},{-25,100},{-23,100},{-21,100},{-19,100},{-18,100},{-16,100},{-14,100},{-12,100},{-11,100},{-9,100},{-7,100},{-5,100},{-3,100},{-2,100},{0,100},{2,100},{3,100},{5,100},{7,100},{9,100},{11,100},{12,100},{14,100},{16,100},{18,100},{19,100},{21,100},{23,100},{25,100},{27,100},{29,100},{31,100},{32,100},{34,100},{36,100},{38,100},{40,100},{42,100},{45,100},{47,100},{49,100},{51,100},{53,100},{55,100},{58,100},{60,100},{62,100},{65,100},{67,100},{70,100},{73,100},{75,100},{78,100},{81,100},{84,100},{87,100},{90,100},{93,100},{97,100},{100,100}};

int cmpr = 1;
int ctD,ctS;
int movD;
int rotS, rotD;
int traS, traD;

int mtrRP[4] = {0,0,0,0};
int mtrA[4] = {0,0,0,0};
int mtrS[4] = {0,0,0,0};
int mtrP[10] = {100,70,47,27,9,-9,-27,-47,-70,-100};
int mtrI[45] = {0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,9,9,9,9,9,9,9,9,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0};
int mtrC = 0;

int ballx,balldist,ballD;
float ballpos;
int firval,birval;
int firno,birno;
int apval,cpval;
int apno,cpno;
int botx;
int valdiff,usdiff;

int usr,usl,usb;

int main(void)
{
    int traM(int D,int S,int A) { 
    	mtrP[0] = mtrP[3] = vd[D][0]*S/100;
    	mtrP[1] = mtrP[2] = vd[D][1]*S/100;
    	
    	cmpr = (cmpr - A)%360;
    	if (cmpr > 180) {
    		rotS = (360 - cmpr)*5/9;
    		rotD = 0;
    	} else {
    		rotS = cmpr*5/9;
    		rotD = 1;
    	}
    	
    	mtrC = S + rotS;
    	
    	if (rotD == 0) {
    		mtrP[0] -= rotS;
    		mtrP[1] += rotS;
    		mtrP[2] -= rotS;
    		mtrP[3] += rotS;
    	} else if (rotD == 1) {
    		mtrP[0] += rotS;
    		mtrP[1] -= rotS;
    		mtrP[2] += rotS;
    		mtrP[3] -= rotS;
    	}
    	
    	for (int i = 0;i < 4;i++) {
    		if (mtrP[i] < 0) {
    			mtrP[i] = -mtrP[i];
    			mtrS[i] = 2;
    		} else {
    			mtrS[i] = 0;
    		}
    		if (mtrP[i] > 100) {
    			mtrP[i] *= 100/mtrC;
    		}
    	}
    	
    	SetMotor( _MOTOR_NE_,mtrS[0],mtrP[0]);
    	SetMotor( _MOTOR_NW_,mtrS[1],mtrP[1]);
    	SetMotor( _MOTOR_SE_,mtrS[2],mtrP[2]);
    	SetMotor( _MOTOR_SW_,mtrS[3],mtrP[3]);
    	return;
    }
    
    int mtrR() {
    	SetMotor(_MOTOR_NE_, 1,0);
    	SetMotor(_MOTOR_NW_, 1,0);
    	SetMotor(_MOTOR_SE_, 1,0);
    	SetMotor(_MOTOR_SW_, 1,0);
    	return;
    }
    while (1)
    {
        GetCompoI3(_COMPOUNDEYE3_cef_, 14);
        GetCompoI3(_COMPOUNDEYE3_ceb_, 14);
        usl = GetADScable10( _SCABLEAD_usl_ );
        usr = GetADScable10( _SCABLEAD_usr_ );
        usb = GetADScable10( _SCABLEAD_usb_);
        
        firval = GetCompoI3( _COMPOUNDEYE3_cef_,9 );
        birval = GetCompoI3( _COMPOUNDEYE3_ceb_,9 );
        firno=GetCompoI3( _COMPOUNDEYE3_cef_,8 );
        birno=GetCompoI3( _COMPOUNDEYE3_ceb_,8 );
        
        if(firval>birval)
        {
        	apno=firno-1;
        	cpno=firno+1;
        	if(apno==0) apno=14;
        	ballpos = (240 + 30*firno)%360; 
        }
        else
        {
        	apno=birno+6;
        	cpno=birno+8;
        	if(cpno==15) cpno=1;
        	ballpos = (60 + 30*birno)%360;
        }
        
        if (apno > 7) {
        	apval = GetCompoI3( _COMPOUNDEYE3_ceb_,apno-7 );
        } else {
        	apval = GetCompoI3( _COMPOUNDEYE3_cef_,apno );
        }
        if (cpno > 7) {
        	cpval = GetCompoI3( _COMPOUNDEYE3_ceb_,cpno-7 );
        } else {
        	cpval = GetCompoI3( _COMPOUNDEYE3_cef_,cpno );
        }
        valdiff = cpval - apval;
        if (valdiff < 0) valdiff *= -1;
        if (valdiff < 5) {
        	ballpos = ballpos;
        } else {
        	if (cpval > apval) {
        		ballpos += 7.5;
        	} else {
        		ballpos -= 7.5;
        	}
        }
        
        if (ballpos < 0) ballpos += 360;
        
        ballD = ballpos/10;
        usl = GetADScable10( _SCABLEAD_usl_ );
        usr = GetADScable10( _SCABLEAD_usr_ );
        usb = GetADScable10( _SCABLEAD_usb_);
        traM(0,30,40);
    }
    return 1;
}

